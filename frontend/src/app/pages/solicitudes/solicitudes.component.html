<div class="page-background">
  <div class="page-background-overlay"></div>
  <div class="solicitudes-page page">
  <div class="solicitudes-header">
    <h1 class="page__title">
      <mat-icon class="mat-icon" style="font-size: 2rem; width: 2rem; height: 2rem; vertical-align: middle; margin-right: 0.5rem;">
        assignment
      </mat-icon>
      Solicitudes de Préstamo
    </h1>
    <p class="meta" style="margin-top: 0.5rem; font-size: 1rem;">
      Gestiona las solicitudes de préstamo de libros en tu biblioteca compartida
    </p>
  </div>

  <div *ngIf="error" class="error-message">
    <mat-icon style="vertical-align: middle; margin-right: 0.5rem;">error</mat-icon>
    {{ error }}
  </div>

  <div class="solicitudes-grid">
    <mat-card *ngFor="let solicitud of solicitudes(); trackBy: trackById"
              class="solicitud-card">

      <div class="solicitud-avatar">
        <mat-icon>{{ solicitud.estado === 'ACEPTADA' ? 'check_circle' :
                    solicitud.estado === 'RECHAZADA' ? 'cancel' :
                    'schedule' }}</mat-icon>
      </div>

      <div class="solicitud-info">
        <h3>
          <mat-icon style="font-size: 1.25rem; width: 1.25rem; height: 1.25rem;">book</mat-icon>
          {{ solicitud.titulo || ('Libro #' + solicitud.id_libro) }}
        </h3>
        <span class="solicitud-libro">{{ solicitud.autor || 'Autor desconocido' }}</span>

        <span class="status-chip" [ngClass]="solicitud.estado.toLowerCase()">
          <mat-icon style="font-size: 0.875rem; width: 0.875rem; height: 0.875rem; margin-right: 0.25rem;">
            {{ solicitud.estado === 'ACEPTADA' ? 'check_circle' :
               solicitud.estado === 'RECHAZADA' ? 'cancel' :
               'schedule' }}
          </mat-icon>
          {{ solicitud.estado }}
        </span>

        <div class="solicitud-details">
          <div class="solicitud-detail">
            <span class="solicitud-detail-label">ID Solicitud:</span>
            <span class="solicitud-detail-value">#{{ solicitud.id_solicitud }}</span>
          </div>
          <div class="solicitud-detail">
            <span class="solicitud-detail-label">Solicitante:</span>
            <span class="solicitud-detail-value"><strong>{{ solicitud.solicitante }}</strong></span>
          </div>
          <div class="solicitud-detail">
            <span class="solicitud-detail-label">Dueño:</span>
            <span class="solicitud-detail-value"><strong>{{ solicitud.duenio }}</strong></span>
          </div>
        </div>

        <div class="solicitud-fechas">
          <div class="fecha-item">
            <mat-icon style="font-size: 0.875rem; width: 0.875rem; height: 0.875rem;">schedule</mat-icon>
            <span>Solicitada: {{ solicitud.solicitada_en | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <div *ngIf="solicitud.decidida_en" class="fecha-item">
            <mat-icon style="font-size: 0.875rem; width: 0.875rem; height: 0.875rem;">event_available</mat-icon>
            <span>Decidida: {{ solicitud.decidida_en | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>

        <div class="solicitud-meta">
          <div class="solicitud-meta-item">
            <mat-icon style="font-size: 0.875rem; width: 0.875rem; height: 0.875rem;">info</mat-icon>
            Solicitud de préstamo pendiente de decisión
          </div>
        </div>
      </div>

      <div *ngIf="solicitud.estado === 'PENDIENTE'" class="acciones-container">
        <button class="aceptar-button" (click)="aceptar(+solicitud.id_solicitud)">
          <mat-icon>check</mat-icon>
          <span>Aceptar</span>
        </button>
        <button class="rechazar-button" (click)="rechazar(+solicitud.id_solicitud)">
          <mat-icon>close</mat-icon>
          <span>Rechazar</span>
        </button>
      </div>
    </mat-card>
  </div>

  <div *ngIf="!error && solicitudes().length===0" class="empty-state">
    <mat-icon>assignment</mat-icon>
    <p>No hay solicitudes de préstamo</p>
    <p class="meta" style="margin-top: 0.5rem;">Las solicitudes aparecerán aquí cuando los usuarios soliciten prestamos de tus libros</p>
  </div>
  </div>
</div>
